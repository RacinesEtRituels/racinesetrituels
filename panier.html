<!DOCTYPE html>
<html class="light" lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Mon Panier â€” Racines & Rituels</title>
  <meta name="description" content="Retrouvez vos produits naturels : KhamarÃ©, Hibiscus et coffrets bien-Ãªtre dans votre panier. Paiement sÃ©curisÃ© et livraison rapide.">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

  <!-- Polices -->
  <link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#e64c19",
            "background-light": "#f8f6f6",
            "background-dark": "#211511",
            terracotta: "#E2725B",
            beige: "#F5F5DC",
            greensoft: "#A9B6A9",
          },
          fontFamily: {
            display: ["Epilogue", "sans-serif"],
          }
        }
      }
    }
  </script>

  <style>
    body {
      font-family: "Epilogue", sans-serif;
    }
  </style>
</head>

<body class="bg-beige dark:bg-background-dark text-gray-800 dark:text-white">

  <div class="min-h-screen flex flex-col">

    <div id="site-header"></div>

    <div class="h-[70px]"></div>

    <!-- ðŸ§º CONTENU PANIER -->
    <main class="flex-1 p-4 max-w-2xl mx-auto w-full space-y-6">

      <h1 class="text-3xl font-bold text-center mb-4">Mon Panier</h1>

      <!-- ðŸ§Š Liste dynamique -->
      <div id="cartItems" class="space-y-4"></div>

      <!-- Si panier vide -->
      <div id="emptyCart" class="hidden text-center py-20 text-gray-600 dark:text-gray-400">
        <p class="text-lg">Votre panier est vide ðŸ§º</p>
        <a href="produits.html" class="text-primary font-semibold underline mt-2 inline-block">Voir les produits</a>
      </div>

      <!-- ðŸ§® RÃ‰CAP TOTAL -->
      <div id="cartSummary" class="hidden p-4 bg-white dark:bg-background-dark/40 rounded-xl shadow space-y-3">

        <div class="flex justify-between">
          <span>Sous-total</span>
          <span id="subtotal">0 â‚¬</span>
        </div>

        <div class="flex justify-between">
          <span>Livraison</span>
          <span id="shipping">5,00 â‚¬</span>
        </div>

        <hr class="border-gray-300 dark:border-gray-700">

        <div class="flex justify-between font-bold text-lg">
          <span>Total</span>
          <span id="total">0 â‚¬</span>
        </div>

        <button id="payBtn" class="w-full h-14 rounded-full bg-terracotta text-white text-lg font-bold hover:bg-terracotta/90 transition">
          Valider et payer
        </button>

      </div>

    </main>

    <script type="module" src="js/header-loader.js"></script>

  </div>

  <!-- ðŸ“Œ CHARGEMENT DU PANIER -->
  <script type="module">
    import { getCart, removeFromCart, updateQuantity } from "./js/cart.js";

    const cartItemsEl = document.getElementById("cartItems");
    const emptyCartEl = document.getElementById("emptyCart");
    const summaryEl = document.getElementById("cartSummary");

    async function loadCart() {
      const cart = await getCart();

      cartItemsEl.innerHTML = "";

      if (!cart || cart.length === 0) {
        emptyCartEl.classList.remove("hidden");
        summaryEl.classList.add("hidden");
        return;
      }

      emptyCartEl.classList.add("hidden");
      summaryEl.classList.remove("hidden");

      let subtotal = 0;

      cart.forEach(item => {
        subtotal += item.price * item.quantity;

        const div = document.createElement("div");
        div.className = "flex gap-4 bg-white dark:bg-background-dark/40 p-4 rounded-xl shadow";

        div.innerHTML = `
          <img src="${item.image}" class="size-[70px] rounded-lg object-cover">

          <div class="flex flex-col justify-between flex-1">
            <p class="font-medium">${item.name}</p>
            <p class="text-greensoft text-sm">${item.price.toFixed(2)} â‚¬</p>
          </div>

          <div class="flex flex-col justify-between items-end">

            <button data-id="${item.id}" class="deleteBtn text-terracotta">
              <span class="material-symbols-outlined text-xl">delete</span>
            </button>

            <div class="flex items-center gap-2">
              <button data-id="${item.id}" class="minusBtn h-7 w-7 flex items-center justify-center rounded-full bg-beige/60 dark:bg-background-dark/60">-</button>
              <span>${item.quantity}</span>
              <button data-id="${item.id}" class="plusBtn h-7 w-7 flex items-center justify-center rounded-full bg-beige/60 dark:bg-background-dark/60">+</button>
            </div>

          </div>
        `;

        cartItemsEl.appendChild(div);
      });

      document.getElementById("subtotal").textContent = subtotal.toFixed(2) + " â‚¬";
      document.getElementById("total").textContent = (subtotal + 5).toFixed(2) + " â‚¬";

      enableButtons();
    }

    function enableButtons() {
      document.querySelectorAll(".deleteBtn").forEach(btn => {
        btn.onclick = async () => {
          await removeFromCart(btn.dataset.id);
          loadCart();
        };
      });

      document.querySelectorAll(".plusBtn").forEach(btn => {
        btn.onclick = async () => {
          await updateQuantity(btn.dataset.id, +1);
          loadCart();
        };
      });

      document.querySelectorAll(".minusBtn").forEach(btn => {
        btn.onclick = async () => {
          await updateQuantity(btn.dataset.id, -1);
          loadCart();
        };
      });
    }

    loadCart();
  </script>

</body>
</html>
